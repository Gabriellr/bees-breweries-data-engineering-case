from mage_ai.settings.repo import get_repo_path
from mage_ai.io.config import ConfigFileLoader
import boto3
from os import path
import logging

if 'data_loader' not in globals():
    from mage_ai.data_preparation.decorators import data_loader

@data_loader
def delete_file_from_s3(*args, **kwargs):
    """
    Deleta um arquivo espec√≠fico de um bucket S3 usando boto3.
    """

    # Bucket e objeto (arquivo) que ser√° deletado
    bucket_name = 'db-inbev-silver-layer'
    object_key = kwargs.get('object_key', '')  # Caminho no S3

    # Inicializa cliente boto3 (usa as credenciais da AWS no ambiente)
    s3_client = boto3.client('s3')

    try:
        logging.info(f"üóëÔ∏è Deletando s3://{bucket_name}/{object_key}...")
        s3_client.delete_object(Bucket=bucket_name, Key=object_key)
        logging.info(f"‚úÖ Arquivo deletado com sucesso.")
        return f"Arquivo deletado: s3://{bucket_name}/{object_key}"

    except Exception as e:
        logging.error(f"‚ùå Falha ao deletar: {str(e)}")
        raise